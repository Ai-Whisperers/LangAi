# CI/CD Rules Index

**Domain:** CI/CD Pipeline Management  
**Version:** 2.0.0  
**Last Updated:** 2025-12-04  
**Reference Implementation:** eneve.domain (59/60 - Framework Ready)

---

## Purpose

This index provides navigation to all CI/CD-related rules, templars, exemplars, and prompts for Azure DevOps pipeline implementation.

**Implementation Status:** This framework produces **59/60 pipelines** (Framework Ready with PowerShell publishing placeholders).  
**Upgrade Path:** Configure NuGet feeds and replace PowerShell@2 with NuGetCommand@2 for 60/60.

---

## Quick Navigation

| Category | Count | Status |
|----------|-------|--------|
| Rules | 1 | Active |
| Templars | 1 | Active |
| Exemplars | 1 | Active |
| Prompts | 1 | Active |
| Documentation | 3 | Active |

---

## Rules

### Tag-Based Versioning

**File:** `tag-based-versioning-rule.mdc`  
**ID:** `rule.cicd.tag-based-versioning.v2`  
**Status:** Active (Reference Implementation)  
**Version:** 2.2.0

**Purpose:** Defines best practices for git tag-based versioning with two-stage RC workflow, automated publishing, and maintenance release support

**Implementation Status:**
- ✅ Produces operational 60/60 pipelines
- ✅ Tag parsing and version extraction
- ✅ All quality gates (security, coverage, documentation)
- ✅ Package creation with SBOM
- ✅ Automated publishing to TEST and PROD feeds

**Key Topics:**
- **Two-Stage RC Workflow**: `test-*-rcN` (internal) → `release-*-rcN` (prerelease) → `release-*` (GA)
- Tag format specification (`[type]-[version]-[suffix]`)
- 5-stage pipeline architecture
- Code immutability between stages
- **Maintenance Releases**: Tag on `release/X.Y` when main is on newer major version
- NuGet prerelease behavior (consumers must opt-in with `--prerelease`)
- Security-first approach (fail on Critical/High vulnerabilities)
- Quality gate enforcement (70%/75%/80% coverage)
- Anti-patterns to avoid

**Applies To:** All .NET repository CI/CD pipelines  
**Reference:** eneve.domain (deployed at 60/60)

---

## Templars (Reusable Templates)

### Unified Pipeline Template (59/60 Reference)

**File:** `.cursor/templars/cicd/azure-pipelines-unified-template.yml`  
**Type:** Azure Pipelines YAML  
**Status:** 59/60 (Framework Ready)

**Purpose:** Reference implementation (59/60) combining:
- Tag-based versioning with version parsing
- 5-stage architecture (Build → Security → Coverage → Package → Documentation)
- Branch-specific quality thresholds (70%/75%/80%)
- Automated security scanning (fail on Critical/High)
- SBOM generation (CycloneDX)
- PowerShell publishing placeholders

**Usage:**
1. Copy to `cicd/azure-pipelines.yml`
2. Customize variables (solution path, project names)
3. Test with coverage tag first
4. Validate with test tag (RC workflow)
5. Download packages from artifacts and manually publish if needed

**Features:**
- ✅ Branch CI (fast feedback, stages 1-3)
- ✅ Tag CD (versioned releases, all 5 stages)
- ✅ Conditional framework (PowerShell placeholders)
- ✅ Dynamic coverage thresholds
- ✅ Comprehensive reporting
- ⚠️ Manual publishing option (framework ready for automation)

**Reference:** Deployed in eneve.domain at 59/60

---

## Exemplars (Real-World Examples)

### Tag-Based Versioning Exemplar

**File:** `.cursor/exemplars/cicd/tag-based-versioning-exemplar.md`  
**ID:** `exemplar.cicd.tag-based-versioning.v2`  
**Status:** Production-Ready (59/60 Reference)  
**Version:** 2.0.0

**Purpose:** Complete example of tag-based versioning implementation at 59/60

**Demonstrates:**
- Complete RC workflow (feature → RC1 → RC2 → production)
- Tag format examples
- Pipeline stage details with current reality
- Version parsing logic
- Manual publishing workflow (download from artifacts)
- Upgrade path to 60/60
- Best practices
- Anti-patterns avoided
- Real metrics from eneve.domain implementation

**Reference Implementation:** eneve.domain (59/60)  
**Framework:** PowerShell placeholders for publishing  
**Note:** Shows what to build FIRST - fully operational with manual publishing option

---

## Prompts (Implementation Guides)

### Implement Tag-Based CI/CD

**File:** `.cursor/prompts/cicd/implement-tag-based-cicd.md`  
**Type:** Step-by-Step Implementation

**Purpose:** Complete guide for implementing tag-based CI/CD pipeline

**Time Estimate:** 2-4 hours

**Phases:**
1. Preparation (30 min)
2. Pipeline Configuration (45 min)
3. Azure DevOps Setup (30 min)
4. Local Testing (45 min)
5. Pipeline Testing (45 min)
6. Documentation (30 min)
7. Team Training (30 min)

**Includes:**
- Prerequisites checklist
- Step-by-step instructions
- Validation checkpoints
- Troubleshooting guide
- Success criteria

---

## Documentation (Generated)

### Core Guides

**Location:** `cicd/docs/`  
**Type:** User Documentation (Generated by implementation)

**Files Generated:**
- `README.md` - Documentation index
- `BRANCHING-GUIDE.md` - Git branching workflow
- `TAGGING-GUIDE.md` - Tag-based versioning and RC workflow
- `QUICK-REFERENCE.md` - Daily commands
- `PIPELINE-STATUS.md` - Current capabilities (59/60 status)

**Audience:** All developers using the repository

### Branching Guide

**File:** `cicd/docs/BRANCHING-GUIDE.md`  
**Version:** 1.0.0

**Contents:**
- Branch structure (main, develop, release/*, feature/*, fix/*, hotfix/*)
- Branch lifecycle workflows
- When to create each branch type
- Branch naming conventions
- Branch protection policies
- Complete workflow examples

### Tagging Guide

**File:** `cicd/docs/TAGGING-GUIDE.md`  
**Version:** 3.0.0

**Contents:**
- Tag format specification
- Tag types (release-*, test-*, coverage-*)
- RC workflow explanation
- Semantic versioning
- Tag management commands
- Branch-tag rules
- Troubleshooting
- Best practices
- Quick reference card

### Quick Reference

**File:** `cicd/docs/QUICK-REFERENCE.md`

**Contents:**
- Pipeline stages overview
- Quality gates and thresholds
- Common scenarios and fixes
- Tag workflows
- Local testing commands
- Tips and tricks

### Pipeline Status

**File:** `cicd/docs/PIPELINE-STATUS.md`

**Contents:**
- Current capabilities (59/60)
- What works today vs. what needs configuration
- 5-stage architecture details
- Quality gates operational status
- Upgrade path to 60/60
- Detailed gap analysis

### Historical Documents (Optional Reference)

**Files:**
- `cicd/docs/archive/` - Phase 1 implementation tracking files
- `docs/CICD-ANALYSIS-SUMMARY.md` - Historical analysis
- `docs/CICD-ANALYSIS-TRACKER.md` - Detailed historical comparison

**Purpose:** Historical context for how we arrived at the 59/60 reference standard

**Note:** These are historical documents. Current status is in `PIPELINE-STATUS.md`.

---

## Usage Patterns

### For New Repository (59/60)

**Goal:** Deploy reference implementation (fully operational with manual publishing)

1. **Read:** `tag-based-versioning-exemplar.md` (59/60 reference)
2. **Follow:** `implement-tag-based-cicd.md` prompt
3. **Copy:** `azure-pipelines-unified-template.yml` → `cicd/azure-pipelines.yml`
4. **Customize:** Solution path, project names
5. **Test:** Create `coverage-0.0.1` tag
6. **Validate:** Create `test-0.0.1-rc1` tag
7. **Verify:** Download packages from Azure DevOps artifacts
8. **Document:** Generated docs in `cicd/docs/` ready to use
9. **Train:** Team on branching (BRANCHING-GUIDE.md) and tagging (TAGGING-GUIDE.md)

**Result:** Fully operational 59/60 pipeline

### For Upgrading to 60/60

**Prerequisites:** 59/60 operational, feeds configured

1. **Configure:** NuGet feeds in Azure Artifacts
2. **Update:** Replace PowerShell@2 publishing tasks with NuGetCommand@2
3. **Configure:** Feed names and service connections in YAML
4. **Test:** `test-*` tag publishes to test feed
5. **Validate:** `release-*` tag publishes to production feed
6. **Update:** PIPELINE-STATUS.md to reflect 60/60

**Result:** Fully automated 60/60 pipeline

### For Existing Repository Upgrade

**If starting from scratch:**
1. Follow "For New Repository" path above

**If upgrading existing pipeline:**
1. **Compare:** Current pipeline vs. template
2. **Backup:** Existing `azure-pipelines.yml`
3. **Copy:** Template to `cicd/azure-pipelines.yml`
4. **Migrate:** Custom logic from old pipeline
5. **Test:** Coverage tag, test tag, release tag
6. **Verify:** All quality gates passing

### For Troubleshooting

1. **Check:** `cicd/docs/QUICK-REFERENCE.md` troubleshooting section
2. **Review:** `cicd/docs/TAGGING-GUIDE.md` troubleshooting
3. **Check:** `cicd/docs/PIPELINE-STATUS.md` for current capabilities
4. **Consult:** `tag-based-versioning-rule.mdc` for anti-patterns
5. **Verify:** Tag format, pipeline triggers, Azure DevOps configuration

---

## Related Rules

### Git Branch Strategy
- `rule.git.branch-naming-rule.v1`
- `rule.git.branch-lifecycle-rule.v1`
- `rule.git.branch-structure-rule.v1`

### Documentation
- `rule.documentation.documentation-standards-rule.v1`
- `rule.documentation.documentation-testing-rule.v1`

### Code Quality
- `rule.code-quality-and-best-practices`
- `rule.clean-code`

---

## Key Principles

### 1. Tags Drive Versions
Git tags are the single source of truth for package versions.

### 2. Two-Stage RC Workflow is Mandatory
- `test-X.Y.Z-rcN` → Internal testing (TEST feed)
- `release-X.Y.Z-rcN` → External/consumer testing (PROD feed as NuGet prerelease)
- `release-X.Y.Z` → GA release (PROD feed as stable) - SAME CODE as last passing release RC

### 3. Code Immutability Between Stages
No code changes allowed when transitioning between stages (last passing RC → GA).

### 4. Security-First
All builds must pass security scanning; Critical/High vulnerabilities fail builds.

### 5. Quality Gates Enforced
Branch-specific coverage thresholds prevent quality regression (70%/75%/80%).

### 6. Maintenance Releases for Older Versions
When main is on newer major version, tag `release-X.Y.Z` directly on `release/X.Y` - never merge to main.

---

## Success Metrics

**Reference Implementation (eneve.domain at 59/60):**

- **Security:** 100% of builds scanned for vulnerabilities (fail on Critical/High)
- **Coverage:** Branch-specific thresholds enforced (70%/75%/80%)
- **Reliability:** 95%+ pipeline success rate
- **Speed:** ~5-7 min for branch CI, ~10-12 min for tag CD
- **Adoption:** RC workflow framework operational
- **Artifacts:** 100% of tag builds produce packages and SBOM
- **Status:** Fully operational with manual publishing option

**After Feed Configuration (60/60):**
- All of the above PLUS
- **Publishing:** Automated to test and production feeds
- **Adoption:** 100% of releases fully automated

---

## Maintenance

### Update Schedule

- **Quarterly:** Review pipeline performance metrics
- **Semi-Annually:** Update security scanning tools
- **Annually:** Review Azure DevOps new features for adoption
- **As Needed:** Update documentation for process changes

### Feedback Loop

- Collect developer feedback on RC workflow
- Monitor pipeline failure patterns
- Identify bottlenecks and optimize
- Share learnings across teams

---

## Support

**Questions or Issues:**
- Review this index first
- Check documentation files
- Consult exemplar for real-world examples
- Contact DevOps team for assistance

**Improvements:**
- Propose via RFC process
- Test in single repository first
- Document learnings
- Roll out to other repositories

---

**Index Version:** 2.0.0  
**Last Updated:** 2025-12-04  
**Implementation Status:** 59/60 (Reference: eneve.domain)  
**Maintained By:** DevOps Team

---

## Quick Start

**Want to implement this in your repository?**

1. Read `.cursor/exemplars/cicd/tag-based-versioning-exemplar.md`
2. Follow `.cursor/prompts/cicd/implement-tag-based-cicd.md`
3. Copy `.cursor/templars/cicd/azure-pipelines-unified-template.yml`
4. Test with tags: `coverage-*` → `test-*-rc1` → `release-*`
5. Use generated docs in `cicd/docs/` for team training

**Result:** Operational 59/60 pipeline in 2-3 hours

**Upgrade to 60/60:** Configure feeds (1-2 hours additional)
