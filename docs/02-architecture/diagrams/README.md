# Architecture Diagrams

Visual representations of the Company Researcher system architecture.

## System Overview

```
+===========================================================================+
|                         COMPANY RESEARCHER                                 |
+===========================================================================+
|                                                                            |
|  USER INTERFACE                                                            |
|  +--------+  +---------------+  +------------+  +-----------+              |
|  |  CLI   |  | LangGraph     |  | Python API |  | REST API  |              |
|  |        |  | Studio        |  |            |  | (Future)  |              |
|  +---+----+  +-------+-------+  +-----+------+  +-----+-----+              |
|      |               |                |               |                    |
|      +---------------+----------------+---------------+                    |
|                              |                                             |
|  +---------------------------v----------------------------+                |
|  |                    WORKFLOW ENGINE                     |                |
|  |                    (LangGraph)                         |                |
|  +----------------------------+---------------------------+                |
|                               |                                            |
|  +-------------------------------------------------------------------------------------------+
|  |                                    AGENT LAYER                                             |
|  |  +------------+  +------------+  +------------+  +-----------+  +-------------+           |
|  |  | Researcher |  | Financial  |  |   Market   |  |  Product  |  | Synthesizer |           |
|  |  |   Agent    |  |   Agent    |  |   Agent    |  |   Agent   |  |    Agent    |           |
|  |  +------------+  +------------+  +------------+  +-----------+  +-------------+           |
|  |                                                                                            |
|  |  +--------------+  +---------------+  +----------------+                                   |
|  |  |  Competitor  |  | Logic Critic  |  | Quality        |                                   |
|  |  |    Scout     |  |    Agent      |  | Checker        |                                   |
|  |  +--------------+  +---------------+  +----------------+                                   |
|  +-------------------------------------------------------------------------------------------+
|                               |                                            |
|  +---------------------------v----------------------------+                |
|  |                    INTEGRATION LAYER                   |                |
|  |  +----------+  +--------+  +-----------+  +---------+  |                |
|  |  |  Tavily  |  |yfinance|  |   GNews   |  | SEC     |  |                |
|  |  +----------+  +--------+  +-----------+  | EDGAR   |  |                |
|  |  +----------+  +--------+  +-----------+  +---------+  |                |
|  |  |DuckDuckGo|  | Alpha  |  |  NewsAPI  |  | Hunter  |  |                |
|  |  +----------+  | Vantage|  +-----------+  +---------+  |                |
|  |                +--------+                               |                |
|  +--------------------------------------------------------+                |
|                               |                                            |
|  +---------------------------v----------------------------+                |
|  |                    FOUNDATION LAYER                    |                |
|  |  +-----------+  +--------+  +---------+  +-----------+ |                |
|  |  |    LLM    |  | Config |  | Logging |  |Observabil-| |                |
|  |  |  Factory  |  | Manager|  | System  |  |   ity     | |                |
|  |  +-----------+  +--------+  +---------+  +-----------+ |                |
|  +--------------------------------------------------------+                |
|                                                                            |
+============================================================================+
```

## Workflow Diagram

```
                          START
                            |
                            v
                    +---------------+
                    |  RESEARCHER   |
                    |    AGENT      |
                    +-------+-------+
                            |
         +------------------+------------------+
         |                  |                  |
         v                  v                  v
  +-----------+      +-----------+      +-----------+
  | FINANCIAL |      |   MARKET  |      |  PRODUCT  |
  |   AGENT   |      |   AGENT   |      |   AGENT   |
  +-----------+      +-----------+      +-----------+
         |                  |                  |
         +------------------+------------------+
                            |
                            v
                    +---------------+
                    | SYNTHESIZER   |
                    |    AGENT      |
                    +-------+-------+
                            |
                            v
                    +---------------+
                    | LOGIC CRITIC  |
                    +-------+-------+
                            |
                            v
                    +---------------+
                    | QUALITY CHECK |
                    +-------+-------+
                            |
              +-------------+-------------+
              |                           |
        [score >= 85%]             [score < 85%]
        [OR iter >= 2]             [AND iter < 2]
              |                           |
              v                           v
       +------------+              +------------+
       | SAVE       |              |  ITERATE   |
       | REPORT     |              | (loop back)|
       +------------+              +------------+
              |                           |
              v                           |
            END <-------------------------+
```

## Data Flow Diagram

```
+----------------+
|  Company Name  |
+-------+--------+
        |
        v
+-------+--------+     +-----------------+
|  Query Gen     |---->|  Search Queries |
+-------+--------+     +-----------------+
        |
        v
+-------+--------+     +-----------------+
|   Web Search   |---->|  Search Results |
+-------+--------+     +-----------------+
        |
        +------------------------------------------+
        |                    |                     |
        v                    v                     v
+-------+--------+   +-------+--------+   +-------+--------+
| Financial      |   |  Market        |   |  Product       |
| Analysis       |   |  Analysis      |   |  Analysis      |
+-------+--------+   +-------+--------+   +-------+--------+
        |                    |                     |
        +------------------------------------------+
                             |
                             v
                   +---------+---------+
                   |    Synthesis      |
                   +---------+---------+
                             |
                             v
                   +---------+---------+
                   |  Quality Check    |
                   +---------+---------+
                             |
                    +--------+--------+
                    |                 |
                    v                 v
            +-------+------+  +------+-------+
            | Final Report |  | Iterate      |
            +--------------+  +--------------+
```

## State Diagram

```
+==============================================================+
|                        STATE OBJECT                           |
+==============================================================+
|                                                               |
|  INPUT                                                        |
|  +----------------------------------------------------------+ |
|  | company_name: str                                        | |
|  +----------------------------------------------------------+ |
|                                                               |
|  RESEARCH DATA                                                |
|  +----------------------------------------------------------+ |
|  | search_queries: List[str]                                | |
|  | search_results: List[Dict]  ← Annotated[add]             | |
|  | sources: List[str]          ← Annotated[add]             | |
|  +----------------------------------------------------------+ |
|                                                               |
|  AGENT OUTPUTS                                                |
|  +----------------------------------------------------------+ |
|  | agent_outputs: Dict         ← Annotated[merge_dicts]     | |
|  |   ├── researcher: {...}                                  | |
|  |   ├── financial: {...}                                   | |
|  |   ├── market: {...}                                      | |
|  |   ├── product: {...}                                     | |
|  |   └── competitor: {...}                                  | |
|  +----------------------------------------------------------+ |
|                                                               |
|  QUALITY                                                      |
|  +----------------------------------------------------------+ |
|  | quality_score: float                                     | |
|  | gaps_detected: List[str]                                 | |
|  | contradictions: List[Dict]                               | |
|  +----------------------------------------------------------+ |
|                                                               |
|  CONTROL                                                      |
|  +----------------------------------------------------------+ |
|  | iteration_count: int                                     | |
|  | current_phase: str                                       | |
|  +----------------------------------------------------------+ |
|                                                               |
|  COST TRACKING                                                |
|  +----------------------------------------------------------+ |
|  | total_cost: float           ← Annotated[add]             | |
|  | total_tokens: Dict          ← Annotated[add_tokens]      | |
|  |   ├── input: int                                         | |
|  |   └── output: int                                        | |
|  +----------------------------------------------------------+ |
|                                                               |
|  OUTPUT                                                       |
|  +----------------------------------------------------------+ |
|  | comprehensive_report: str                                | |
|  | report_path: str                                         | |
|  +----------------------------------------------------------+ |
|                                                               |
+==============================================================+
```

## Agent Architecture

```
+========================================+
|           AGENT HIERARCHY              |
+========================================+
|                                        |
|   BaseAgent (Abstract)                 |
|       |                                |
|       +-- BaseSpecialistAgent[T]       |
|       |       |                        |
|       |       +-- FinancialAgent       |
|       |       +-- MarketAgent          |
|       |       +-- ProductAgent         |
|       |       +-- BrandAuditorAgent    |
|       |       +-- SocialMediaAgent     |
|       |                                |
|       +-- CoreAgent                    |
|               |                        |
|               +-- ResearcherAgent      |
|               +-- AnalystAgent         |
|               +-- SynthesizerAgent     |
|               +-- LogicCriticAgent     |
|                                        |
+========================================+

+========================================+
|         AGENT NODE PATTERN             |
+========================================+
|                                        |
|   @agent_node(                         |
|       agent_name="financial",          |
|       max_tokens=2000,                 |
|       temperature=0.0                  |
|   )                                    |
|   def financial_agent_node(            |
|       state: OverallState,             |
|       logger: Logger,                  |
|       client: Anthropic,               |
|       config: ResearchConfig           |
|   ) -> Dict[str, Any]:                 |
|       # Agent implementation           |
|       return {                         |
|           "agent_outputs": {...},      |
|           "total_cost": 0.05           |
|       }                                |
|                                        |
+========================================+
```

## Integration Architecture

```
+================================================================+
|                    INTEGRATION LAYER                            |
+================================================================+
|                                                                 |
|  SEARCH PROVIDERS                                               |
|  +------------------+     +------------------+                  |
|  |     Tavily       |     |   DuckDuckGo     |                  |
|  | (LLM-optimized)  |     |    (Fallback)    |                  |
|  | Paid after free  |     |      Free        |                  |
|  +------------------+     +------------------+                  |
|                                                                 |
|  FINANCIAL DATA                                                 |
|  +----------+  +----------+  +----------+  +----------+         |
|  | yfinance |  |   Alpha  |  |   FMP    |  | Finnhub  |         |
|  |  (Free)  |  | Vantage  |  |          |  |          |         |
|  +----------+  +----------+  +----------+  +----------+         |
|                                                                 |
|  NEWS SOURCES                                                   |
|  +----------+  +----------+  +----------+                       |
|  |  GNews   |  | NewsAPI  |  |Mediastack|                       |
|  +----------+  +----------+  +----------+                       |
|                                                                 |
|  COMPANY DATA                                                   |
|  +----------+  +----------+  +----------+  +----------+         |
|  | Hunter.io|  |Domainsdb |  | GitHub   |  |  Reddit  |         |
|  +----------+  +----------+  +----------+  +----------+         |
|                                                                 |
|  LLM PROVIDERS                                                  |
|  +------------------+     +------------------+                  |
|  |    Anthropic     |     |     OpenAI       |                  |
|  | (Claude Primary) |     |   (Fallback)     |                  |
|  +------------------+     +------------------+                  |
|                                                                 |
|  OBSERVABILITY                                                  |
|  +------------------+     +------------------+                  |
|  |    AgentOps      |     |    LangSmith     |                  |
|  | (Agent Tracking) |     |  (LLM Tracing)   |                  |
|  +------------------+     +------------------+                  |
|                                                                 |
+================================================================+
```

## Quality System

```
+================================================================+
|                      QUALITY SYSTEM                             |
+================================================================+
|                                                                 |
|  QUALITY CHECK FLOW                                             |
|                                                                 |
|  Agent Outputs                                                  |
|       |                                                         |
|       v                                                         |
|  +----------------+                                             |
|  | Extract Facts  |                                             |
|  +-------+--------+                                             |
|          |                                                      |
|          v                                                      |
|  +----------------+     +----------------+                      |
|  |   Detect       |---->| Contradictions |                      |
|  | Contradictions |     |    Found       |                      |
|  +-------+--------+     +----------------+                      |
|          |                                                      |
|          v                                                      |
|  +----------------+     +----------------+                      |
|  |   Detect       |---->|     Gaps       |                      |
|  |     Gaps       |     |   Detected     |                      |
|  +-------+--------+     +----------------+                      |
|          |                                                      |
|          v                                                      |
|  +----------------+     +----------------+                      |
|  |   Calculate    |---->| Quality Score  |                      |
|  |    Score       |     |   (0-100)      |                      |
|  +-------+--------+     +----------------+                      |
|          |                                                      |
|          v                                                      |
|  +-------+--------+                                             |
|  |    Decision    |                                             |
|  +-------+--------+                                             |
|          |                                                      |
|    +-----+-----+                                                |
|    |           |                                                |
|    v           v                                                |
| [>= 85%]   [< 85%]                                              |
| FINISH     ITERATE                                              |
|                                                                 |
+================================================================+
```

---

**Related Documentation**:
- [System Design](../SYSTEM_DESIGN.md)
- [Data Flow](../DATA_FLOW.md)
- [Agent Patterns](../AGENT_PATTERNS.md)

---

**Last Updated**: December 2024
